<tool id="sam_compare_w_feature" name="Compare SAM files and output read counts for BASE" version="0.1.0">
    <description>Compare 2 sam files and count variant combinations</description>
    <macros>
      <import>../macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command><![CDATA[
    python '$__tool_directory__/sam_compare_w_feature.py'
    --fastq=$fastq
    --sama=$sama
    --samb=$samb
    --feature=$feature
    --length=`awk '{if(NR%4==2 && length) {count++; bases += length}} END {print bases/count}' ${fastq} | awk '{printf "%.0f", $1}'`
    --nofqids=$nofqids
    --counts=$counts
    --totals=$totals
]]></command>
    <inputs>
        <param name="fastq" type="data" format="fastq" label="Name of the Fastq file used to generate the 2 SAM files" help="Select the Fastq file used to generate the sam files [REQUIRED]"/>
        <param name="sama" type="data" format="tabular" label="SAM file with G1 reference" help="Name of the first SAM file (SAM A) containing reads aligned to G1 reference [REQUIRED]"/>
        <param name="samb" type="data" format="tabular" label="SAM file with G2 reference" help="Name of the first SAM file (SAM B) containing reads aligned to G2 reference [REQUIRED]"/>
        <param name="feature" type="data" format="tabular" label="File containing features to assign reads to" help="Select file containing features to assign read to. Can be a .tsv or .bed [REQUIRED]"/>
	<param name="nofqids" type="select" value="" display="radio" label="Check Fastq IDs" help="Select No to skip checking SAM QNAME against the fastq sequence IDs. Saves time if already known to be good.">
            <option value="False" selected="true">Yes</option>
            <option value="True">No</option>
        </param>
    </inputs>
    <outputs>
        <data name="counts" format="tabular" label="${tool.name} on ${on_string}: ASE Counts Table"/>
        <data name="totals" format="tabular" label="${tool.name} on ${on_string}: ASE Totals Table"/>
    </outputs>
    <help><![CDATA[
**Tool Description**
This tool is used to compare two SAM files and determine how the read from an individual fastq file align to each reference.  
The tool compares the SAM files and determines whether a read maps better to one of the references or equally well to both.

**Input**        
Fastq file used to generate the 2 SAM files
The tool calculates the average read length in the input fastq file and uses the average read length as an input for the script to generate ouputs
SAM file generated by aligning the Fastq file to genome G1 (SAM A)
SAM file generated by aligning the Fastq file to genome G2 (SAM B)
Feature/BED file containing features to assign reads to

**Output**
The tools generates 2 output TSV files:

(1) An ASE counts table containing, for each feature listed in the input Feature/BED table, the counts for that feature

(2) An ASE totals table containing a summary of the reads aligning to the the G1 and G2 references  
    ]]></help>
</tool>
