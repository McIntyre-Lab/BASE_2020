<tool id="base_BWASplitSam" name="BWA Split Sam" version="0.1.0" python_template_version="3.5">
    <description>takes a SAM file and subsets it based on the values of the SAM flags</description>
    <macros>
      <import>../macros.xml</import>
    </macros>
    <expand macro="requirements" />
    <command><![CDATA[
    python '$__tool_directory__/BWASplitSAM_SEonly.py3'
          --sam=$sam
          --fq1=$fq1
          --map=$map
          --opp=$opp
          --amb=$amb
          --chi=$chi
          --notp=$notp
          --unmap_read=$unmap_read
          --amb_read=$amb_read
          --summ=$summ
]]>
    </command>
    <inputs>
        <param name="sam" type="data" format="sam" label="SAM file" help="Select the SAM file for subsetting"/>
        <param name="fq1" type="data" format="fastq" label="FQ1 file" help="Select the FastQ file used to generate the above SAM file" />
    </inputs>
    <outputs>
        <data type="list" format="sam" name="map" label="${tool.name} on ${on_string}: BWASplitSAM mapped"/>
        <data type="list" format="sam" name="opp" label="${tool.name} on ${on_string}: BWASplitSAM opposite"/>
        <data type="list" format="sam" name="amb" label="${tool.name} on ${on_string}: BWASplitSAM ambiguous"/>
        <data type="list" format="sam" name="chi" label="${tool.name} on ${on_string}: BWASplitSAM chimeric"/>
        <data type="list" format="sam" name="notp" label="${tool.name} on ${on_string}: BWASplitSAM not primary"/>
        <data type="list" format="fastq" name="unmap_read" label="${tool.name} on ${on_string}: BWASplitSAM unmapped reads"/>
        <data type="list" format="fastq" name="amb_read" label="${tool.name} on ${on_string}: BWASplitSAM ambiguous reads"/>
        <data type="list" format="tabular" name="summ" label="${tool.name} on ${on_string}: BWASplitSAM summary file"/>
    </outputs>
    <help><![CDATA[
**Tool Description**    

This tool subsets a SAM file based on values in the Flag column of the SAM file.  
**NOTE:  SAM file must be generated from a SE alignment using BWA-MEM!**

**Input**

    (1) A SAM file generated from a SE alignment.
    (2) The FQ file used to generate the SAM file

**Output**

The following SAM files are generated based on the SAM flag values in the starting SAM file: 

(1) **mapped.sam**       Contains uniquely mapping reads on forward strand
(2) **unmapped.sam**     Contains reads that do not align
(3) **opposite.sam**     Contains uniquely mapping on reverse strand
(4) **ambiguous.sam**    Reads that do not uniquely map
(5) **chimeric.sam**     Reads that align to distinct positions in the genome with little to no overlap 
(6) **not_primary.sam**  Contains reads that are not primary alignments

The following FASTQ files are generated based on the SAM flags:

(1) **ambiguous.fq**  FASTQ file containing reads that map ambiguously to the reference
(2) **unmapped.fq**   FASTQ file containing reads that do not map to the reference

**A summary TSV file** containing the numbers of reads that fall into each of the above groups.
    ]]></help>
</tool>
